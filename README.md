# e-foosball

Foosball is fun! Foosball with lights, sound effects, and active score tracking is even better!

## Intro

This repository contains Arduino and Python source code to poll goal sensors, drive goal box LED lights for effect, maintain score state, and update LED score indicators.

Why Arduino <strong><em>and</em></strong> Python? The Arduino code drives the hardware - sensors and LEDs. The Python code runs on a Raspberry Pi and primarily plays sound effects but future improvements will bring score persistence, stats, and a foosball web server. Playing audio is too expensive to perform on the Arduino and its 25k usable memory doesn't cut it for most audio playback.

## Overview
### Materials
* Tornado foosball table (obviously any other table works too!)
* Arduino Uno R3
* Raspberry Pi (any model with a 3.5mm stereo jack works)
* Cheapo computer power supply which has both 5V and 12V rails
* Computer speakers
* [Adafruit Neopixel Digital LED strips](https://www.adafruit.com/products/1138) for score keeping
* [Generic Analog 12V RGB LED strips](https://www.adafruit.com/products/285) for goalbox lighting and effects
* Pair of [Breakbeam infared sensors](https://www.adafruit.com/products/2168) for ball detection in each goalbox
* Resistors, capactitors, [power MOSFETs](https://www.adafruit.com/products/355) for driving the analog LEDs, and other electronic components

### Arduino
The Arduino source code is located in a single sketch file - [FoosballArduino.ino] (FoosballArduino/FoosballArduino.ino) 

The code runs on an Arduino Uno R3 and can be adapted for any Atmega Arduino board by changing the pinout variables.

The Arduino code polls two infared sensors, one for each goalbox. Upon detecting a trip when the ball goes in the goalbox, the goalbox analog LED strips flash and the digital LED strips increment score. A basic FSM implements this logic. 

The Arduino also maintains the score and sends it through serial over USB to the Raspberry Pi for every detected goal.

### Raspberry Pi
The Raspberry Pi runs the Debian-based OS Raspbian with Python 2.7 installed. The e-foosball python code is located: [GameManager.py](GameManager/GameManager.py)

The following python packages must be installed prior to running `GameManager.py`
```
sudo apt-get install python-serial
sudo apt-get install python-pygame
```


The Pi opens a serial connection using PySerial and listens for game events (i.e. new game, goals) generated by the Arduino. Upon receiving a game event, the event is passed to event handlers to perform actions on the event. One event handler, `SoundEventHandler` plays different sounds depending on the score.

